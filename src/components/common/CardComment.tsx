import React, { useState } from 'react';
import Button from './Button';
import CreateComment from './CreateComment';
import { Comment, CommentInfo } from '@/store/types';

const CardComment = ({ comment, commentInfo }: { commentInfo: CommentInfo; comment?: Comment }) => {
  const [modal, setModal] = useState<{
    open: boolean;
    info: null | Comment;
    admin?: boolean;
    parent: string;
  }>({
    open: false,
    info: null,
    parent: '',
    admin: false,
  });
  return (
    <>
      <div>
        <div className="rounded-lg border border-[#E5EAEF] bg-[#F4F6FA] p-3 dark:border-[#263248] dark:bg-[#172334] lg:h-fit lg:p-[24px]">
          <div className="flex items-center gap-4">
            <span>
              <svg
                width="32"
                height="33"
                viewBox="0 0 32 33"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <rect y="0.724609" width="32" height="32" rx="4" fill="#E5EAEF" />
                <path
                  opacity="0.4"
                  d="M15.9987 16.724C19.6806 16.724 22.6654 13.7392 22.6654 10.0573C22.6654 6.37539 19.6806 3.39062 15.9987 3.39062C12.3168 3.39062 9.33203 6.37539 9.33203 10.0573C9.33203 13.7392 12.3168 16.724 15.9987 16.724Z"
                  fill="#505B74"
                />
                <path
                  opacity="0.4"
                  d="M15.9989 20.0586C9.3189 20.0586 3.87891 24.5386 3.87891 30.0586C3.87891 30.4319 4.17224 30.7253 4.54557 30.7253H27.4522C27.8256 30.7253 28.1189 30.4319 28.1189 30.0586C28.1189 24.5386 22.6789 20.0586 15.9989 20.0586Z"
                  fill="#505B74"
                />
              </svg>
            </span>
            <p className="font-medium dark:text-[#E5EAEF]">
              {comment?.author.firstName} {comment?.author?.lastName}
            </p>
            {comment?.author.role === 'ADMIN' || comment?.author.role === 'GOD' ? (
              <div className="flex items-center gap-2">
                <span>
                  <svg
                    width="21"
                    height="19"
                    viewBox="0 0 21 19"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M10.1328 0.195312C8.81959 0.195312 7.51923 0.45397 6.30598 0.956517C5.09272 1.45906 3.99033 2.19566 3.06175 3.12424C1.18638 4.99961 0.132813 7.54315 0.132812 10.1953V17.1953C0.132813 17.4605 0.238169 17.7149 0.425706 17.9024C0.613242 18.09 0.867596 18.1953 1.13281 18.1953H4.13281C4.92846 18.1953 5.69152 17.8792 6.25413 17.3166C6.81674 16.754 7.13281 15.991 7.13281 15.1953V13.1953C7.13281 12.3997 6.81674 11.6366 6.25413 11.074C5.69152 10.5114 4.92846 10.1953 4.13281 10.1953H2.13281C2.13281 8.07358 2.97567 6.03875 4.47596 4.53846C5.97625 3.03817 8.01108 2.19531 10.1328 2.19531C12.2545 2.19531 14.2894 3.03817 15.7897 4.53846C17.29 6.03875 18.1328 8.07358 18.1328 10.1953H16.1328C15.3372 10.1953 14.5741 10.5114 14.0115 11.074C13.4489 11.6366 13.1328 12.3997 13.1328 13.1953V15.1953C13.1328 15.991 13.4489 16.754 14.0115 17.3166C14.5741 17.8792 15.3372 18.1953 16.1328 18.1953H19.1328C19.398 18.1953 19.6524 18.09 19.8399 17.9024C20.0275 17.7149 20.1328 17.4605 20.1328 17.1953V10.1953C20.1328 7.54315 19.0792 4.99961 17.2039 3.12424C15.3285 1.24888 12.785 0.195313 10.1328 0.195312V0.195312ZM4.13281 12.1953C4.39803 12.1953 4.65238 12.3007 4.83992 12.4882C5.02746 12.6757 5.13281 12.9301 5.13281 13.1953V15.1953C5.13281 15.4605 5.02746 15.7149 4.83992 15.9024C4.65238 16.09 4.39803 16.1953 4.13281 16.1953H2.13281V12.1953H4.13281ZM18.1328 16.1953H16.1328C15.8676 16.1953 15.6132 16.09 15.4257 15.9024C15.2382 15.7149 15.1328 15.4605 15.1328 15.1953V13.1953C15.1328 12.9301 15.2382 12.6757 15.4257 12.4882C15.6132 12.3007 15.8676 12.1953 16.1328 12.1953H18.1328V16.1953Z"
                      fill="#6E3DFF"
                    />
                  </svg>
                </span>
                <span className="font-medium text-main">پشتیبانی</span>
              </div>
            ) : null}

            <div className="flex items-center gap-2">
              <svg
                width="24"
                height="25"
                viewBox="0 0 24 25"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M16 3.04199C16.1547 3.04199 16.3027 3.1035 16.4121 3.21289C16.5215 3.32229 16.583 3.47029 16.583 3.625V5.04199H19C19.6851 5.04199 20.3427 5.31338 20.8271 5.79785C21.3116 6.28232 21.583 6.93986 21.583 7.625V19.625C21.583 20.3101 21.3116 20.9677 20.8271 21.4521C20.3427 21.9366 19.6851 22.208 19 22.208H5C4.40032 22.208 3.82206 21.9999 3.3623 21.623L3.17285 21.4521C2.68838 20.9677 2.41699 20.3101 2.41699 19.625V7.625L2.42969 7.37012C2.47997 6.86289 2.67882 6.38151 3.00195 5.9873L3.17285 5.79785C3.65732 5.31338 4.31486 5.04199 5 5.04199H7.41699V3.625C7.41699 3.50908 7.45133 3.39683 7.51465 3.30176L7.58789 3.21289C7.66997 3.13081 7.77357 3.07513 7.88574 3.05273L8 3.04199C8.11592 3.04199 8.22817 3.07633 8.32324 3.13965L8.41211 3.21289C8.52151 3.32229 8.58301 3.47029 8.58301 3.625V5.04199H15.417V3.625C15.417 3.50908 15.4513 3.39683 15.5146 3.30176L15.5879 3.21289C15.67 3.13081 15.7736 3.07513 15.8857 3.05273L16 3.04199ZM3.58301 19.625C3.58301 20.0007 3.73237 20.3613 3.99805 20.627C4.26372 20.8926 4.62428 21.042 5 21.042H19C19.3757 21.042 19.7363 20.8926 20.002 20.627C20.2676 20.3613 20.417 20.0007 20.417 19.625V12.208H3.58301V19.625ZM5 6.20801C4.62428 6.20801 4.26372 6.35737 3.99805 6.62305C3.73237 6.88872 3.58301 7.24928 3.58301 7.625V11.042H20.417V7.625C20.417 7.24928 20.2676 6.88872 20.002 6.62305C19.7363 6.35737 19.3757 6.20801 19 6.20801H16.583V7.625C16.583 7.74092 16.5487 7.85317 16.4854 7.94824L16.4121 8.03711C16.3027 8.1465 16.1547 8.20801 16 8.20801C15.8841 8.20801 15.7718 8.17367 15.6768 8.11035L15.5879 8.03711C15.4785 7.92771 15.417 7.77971 15.417 7.625V6.20801H8.58301V7.625C8.58301 7.77971 8.52151 7.92771 8.41211 8.03711C8.30271 8.14651 8.15471 8.20801 8 8.20801C7.84529 8.20801 7.69729 8.14651 7.58789 8.03711C7.47849 7.92771 7.41699 7.77971 7.41699 7.625V6.20801H5Z"
                  fill="#8E98A8"
                  stroke="#8E98A8"
                  stroke-width="0.833333"
                />
              </svg>

              <div className="flex gap-1">
                <span className="font-medium text-[14px] text-[#6A7890]">
                  {new Date(comment?.createdAt!).toLocaleDateString('fa-IR', {
                    year: 'numeric',
                    month: '2-digit',
                    day: 'numeric',
                  })}
                </span>
              </div>
            </div>
          </div>
          <p className="mt-5 font-medium text-[14px] text-[#505B74] dark:text-[#8E98A8]">
            {comment?.title}
          </p>
          <p className="mt-2 text-wrap font-medium text-[14px] text-[#505B74] dark:text-[#8E98A8]">
            {comment?.content}
          </p>
          <Button
            onClick={() =>
              setModal({ info: null, open: true, admin: false, parent: comment?._id! })
            }
            className="mt-5 h-[36px] !w-[79px] border-2 border-[#E5EAEF] text-main"
          >
            پاسخ
          </Button>
        </div>
        <div className="mt-5">
          {comment?.children.map((item, idx) => (
            <div key={idx} className="flex items-center gap-4">
              <span>
                <svg
                  width="25"
                  height="133"
                  viewBox="0 0 25 133"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M25 1.72461C25 1.17232 24.5523 0.724609 24 0.724609C23.4477 0.724609 23 1.17232 23 1.72461H25ZM0.792893 124.018C0.402369 124.408 0.402369 125.041 0.792893 125.432L7.15685 131.796C7.54738 132.186 8.18054 132.186 8.57107 131.796C8.96159 131.405 8.96159 130.772 8.57107 130.381L2.91421 124.725L8.57107 119.068C8.96159 118.677 8.96159 118.044 8.57107 117.654C8.18054 117.263 7.54738 117.263 7.15685 117.654L0.792893 124.018ZM24 1.72461H23V108.725H24H25V1.72461H24ZM8 124.725V123.725H1.5V124.725V125.725H8V124.725ZM24 108.725H23C23 117.009 16.2843 123.725 8 123.725V124.725V125.725C17.3888 125.725 25 118.113 25 108.725H24Z"
                    fill="#E5EAEF"
                  />
                </svg>
              </span>
              <div className="h-fit w-full rounded-lg border border-[#E5EAEF] bg-[#F4F6FA] p-3 dark:border-[#263248] dark:bg-[#172334] lg:p-[24px]">
                <div className="flex items-center gap-2">
                  <span>
                    <svg
                      width="32"
                      height="33"
                      viewBox="0 0 32 33"
                      fill="none"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <rect y="0.724609" width="32" height="32" rx="4" fill="#E5EAEF" />
                      <path
                        opacity="0.4"
                        d="M15.9987 16.724C19.6806 16.724 22.6654 13.7392 22.6654 10.0573C22.6654 6.37539 19.6806 3.39062 15.9987 3.39062C12.3168 3.39062 9.33203 6.37539 9.33203 10.0573C9.33203 13.7392 12.3168 16.724 15.9987 16.724Z"
                        fill="#505B74"
                      />
                      <path
                        opacity="0.4"
                        d="M15.9989 20.0586C9.3189 20.0586 3.87891 24.5386 3.87891 30.0586C3.87891 30.4319 4.17224 30.7253 4.54557 30.7253H27.4522C27.8256 30.7253 28.1189 30.4319 28.1189 30.0586C28.1189 24.5386 22.6789 20.0586 15.9989 20.0586Z"
                        fill="#505B74"
                      />
                    </svg>
                  </span>

                  <p className="font-medium dark:text-[#E5EAEF]">
                    {item?.author?.firstName} {item?.author?.lastName}
                  </p>
                  {comment?.author.role === 'ADMIN' || comment?.author.role === 'GOD' ? (
                    <div className="flex items-center gap-2">
                      <span>
                        <svg
                          width="21"
                          height="19"
                          viewBox="0 0 21 19"
                          fill="none"
                          xmlns="http://www.w3.org/2000/svg"
                        >
                          <path
                            d="M10.1328 0.195312C8.81959 0.195312 7.51923 0.45397 6.30598 0.956517C5.09272 1.45906 3.99033 2.19566 3.06175 3.12424C1.18638 4.99961 0.132813 7.54315 0.132812 10.1953V17.1953C0.132813 17.4605 0.238169 17.7149 0.425706 17.9024C0.613242 18.09 0.867596 18.1953 1.13281 18.1953H4.13281C4.92846 18.1953 5.69152 17.8792 6.25413 17.3166C6.81674 16.754 7.13281 15.991 7.13281 15.1953V13.1953C7.13281 12.3997 6.81674 11.6366 6.25413 11.074C5.69152 10.5114 4.92846 10.1953 4.13281 10.1953H2.13281C2.13281 8.07358 2.97567 6.03875 4.47596 4.53846C5.97625 3.03817 8.01108 2.19531 10.1328 2.19531C12.2545 2.19531 14.2894 3.03817 15.7897 4.53846C17.29 6.03875 18.1328 8.07358 18.1328 10.1953H16.1328C15.3372 10.1953 14.5741 10.5114 14.0115 11.074C13.4489 11.6366 13.1328 12.3997 13.1328 13.1953V15.1953C13.1328 15.991 13.4489 16.754 14.0115 17.3166C14.5741 17.8792 15.3372 18.1953 16.1328 18.1953H19.1328C19.398 18.1953 19.6524 18.09 19.8399 17.9024C20.0275 17.7149 20.1328 17.4605 20.1328 17.1953V10.1953C20.1328 7.54315 19.0792 4.99961 17.2039 3.12424C15.3285 1.24888 12.785 0.195313 10.1328 0.195312V0.195312ZM4.13281 12.1953C4.39803 12.1953 4.65238 12.3007 4.83992 12.4882C5.02746 12.6757 5.13281 12.9301 5.13281 13.1953V15.1953C5.13281 15.4605 5.02746 15.7149 4.83992 15.9024C4.65238 16.09 4.39803 16.1953 4.13281 16.1953H2.13281V12.1953H4.13281ZM18.1328 16.1953H16.1328C15.8676 16.1953 15.6132 16.09 15.4257 15.9024C15.2382 15.7149 15.1328 15.4605 15.1328 15.1953V13.1953C15.1328 12.9301 15.2382 12.6757 15.4257 12.4882C15.6132 12.3007 15.8676 12.1953 16.1328 12.1953H18.1328V16.1953Z"
                            fill="#6E3DFF"
                          />
                        </svg>
                      </span>
                      <span className="font-medium text-main">پشتیبانی</span>
                    </div>
                  ) : null}
                  <div className="flex items-center gap-2">
                    <svg
                      width="24"
                      height="25"
                      viewBox="0 0 24 25"
                      fill="none"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <path
                        d="M16 3.04199C16.1547 3.04199 16.3027 3.1035 16.4121 3.21289C16.5215 3.32229 16.583 3.47029 16.583 3.625V5.04199H19C19.6851 5.04199 20.3427 5.31338 20.8271 5.79785C21.3116 6.28232 21.583 6.93986 21.583 7.625V19.625C21.583 20.3101 21.3116 20.9677 20.8271 21.4521C20.3427 21.9366 19.6851 22.208 19 22.208H5C4.40032 22.208 3.82206 21.9999 3.3623 21.623L3.17285 21.4521C2.68838 20.9677 2.41699 20.3101 2.41699 19.625V7.625L2.42969 7.37012C2.47997 6.86289 2.67882 6.38151 3.00195 5.9873L3.17285 5.79785C3.65732 5.31338 4.31486 5.04199 5 5.04199H7.41699V3.625C7.41699 3.50908 7.45133 3.39683 7.51465 3.30176L7.58789 3.21289C7.66997 3.13081 7.77357 3.07513 7.88574 3.05273L8 3.04199C8.11592 3.04199 8.22817 3.07633 8.32324 3.13965L8.41211 3.21289C8.52151 3.32229 8.58301 3.47029 8.58301 3.625V5.04199H15.417V3.625C15.417 3.50908 15.4513 3.39683 15.5146 3.30176L15.5879 3.21289C15.67 3.13081 15.7736 3.07513 15.8857 3.05273L16 3.04199ZM3.58301 19.625C3.58301 20.0007 3.73237 20.3613 3.99805 20.627C4.26372 20.8926 4.62428 21.042 5 21.042H19C19.3757 21.042 19.7363 20.8926 20.002 20.627C20.2676 20.3613 20.417 20.0007 20.417 19.625V12.208H3.58301V19.625ZM5 6.20801C4.62428 6.20801 4.26372 6.35737 3.99805 6.62305C3.73237 6.88872 3.58301 7.24928 3.58301 7.625V11.042H20.417V7.625C20.417 7.24928 20.2676 6.88872 20.002 6.62305C19.7363 6.35737 19.3757 6.20801 19 6.20801H16.583V7.625C16.583 7.74092 16.5487 7.85317 16.4854 7.94824L16.4121 8.03711C16.3027 8.1465 16.1547 8.20801 16 8.20801C15.8841 8.20801 15.7718 8.17367 15.6768 8.11035L15.5879 8.03711C15.4785 7.92771 15.417 7.77971 15.417 7.625V6.20801H8.58301V7.625C8.58301 7.77971 8.52151 7.92771 8.41211 8.03711C8.30271 8.14651 8.15471 8.20801 8 8.20801C7.84529 8.20801 7.69729 8.14651 7.58789 8.03711C7.47849 7.92771 7.41699 7.77971 7.41699 7.625V6.20801H5Z"
                        fill="#8E98A8"
                        stroke="#8E98A8"
                        stroke-width="0.833333"
                      />
                    </svg>

                    <div className="flex flex-wrap gap-1">
                      <span className="font-light text-[14px] text-[#8E98A8]">زمان انتشار:</span>
                      <span className="dark:txet-[#8E98A8] font-light text-[14px] text-[#6A7890]">
                        {new Date(comment?.createdAt!).toLocaleDateString('fa-IR', {
                          year: '2-digit',
                          month: '2-digit',
                          day: '2-digit',
                        })}
                      </span>
                    </div>
                  </div>
                </div>
                <p className="mt-5 font-medium text-[14px] text-[#505B74] dark:text-[#8E98A8]">
                  {item?.title}
                </p>
                <p className="mt-2 text-wrap font-medium text-[14px] text-[#505B74] dark:text-[#8E98A8]">
                  {item?.content}
                </p>
              </div>
            </div>
          ))}
        </div>
      </div>
      {modal.open && (
        <CreateComment
          product={{
            thumbnailImage: commentInfo?.thumbnailImage,
            title: commentInfo?.title,
            targetType: commentInfo.targetType,
            _id: commentInfo._id,
          }}
          modal={modal}
          setModal={setModal}
        />
      )}
    </>
  );
};

export default CardComment;
